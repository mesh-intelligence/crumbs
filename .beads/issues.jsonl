{"id":"main-6it","title":"Implement core types and interfaces in pkg/types","description":"## Required Reading\n- docs/ARCHITECTURE.md (System Overview, Main Interfaces, Entity Types, Design Decisions 1-10)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config R1, Cupboard R2, Table R3, Errors R7, UUID R8)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct R1, State values R2, State methods R4, Property methods R5, Filter R9, Errors R11)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (Link entity R2.7 for Link struct, R14 for hydration mappings of all entities)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property and Category structs)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct, lifecycle methods)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct, link types)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct)\n- docs/specs/use-cases/rel01.0-uc001-cupboard-lifecycle.yaml (lifecycle flow)\n- docs/specs/use-cases/rel01.0-uc003-crumb-lifecycle.yaml (state machine flow)\n- docs/specs/test-suites/test-rel01.0-uc001-cupboard-lifecycle.yaml (lifecycle test cases)\n- pkg/crumbs/version.go (existing code)\n- cmd/cupboard/main.go (existing CLI stub)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct, config validation, config errors\n- pkg/types/cupboard.go (create) - Cupboard and Table interfaces, cupboard errors\n- pkg/types/table.go (create) - Table operation errors, entity method errors\n- pkg/types/crumb.go (create) - Crumb struct, state constants, state transition methods (SetState, Pebble, Dust), property methods (SetProperty, GetProperty, GetProperties, ClearProperty)\n- pkg/types/trail.go (create) - Trail struct, state constants, lifecycle methods (Complete, Abandon)\n- pkg/types/property.go (create) - Property struct, Category struct, value type constants\n- pkg/types/metadata.go (create) - Metadata struct\n- pkg/types/link.go (create) - Link struct, link type constants\n- pkg/types/stash.go (create) - Stash struct, StashHistory struct, stash type constants\n- pkg/types/types_test.go (create) - Unit tests for all entity methods and validation\n\n## Requirements\n1. Define Config struct with Backend, DataDir fields and validation per prd001 R1\n2. Define Cupboard interface with GetTable, Attach, Detach per prd001 R2\n3. Define Table interface with Get, Set, Delete, Fetch per prd001 R3\n4. Define all sentinel errors per prd001 R7 (config errors in config.go, cupboard errors in cupboard.go, table/entity errors in table.go)\n5. Define Crumb struct per prd003 R1 (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties)\n6. Define crumb state constants (draft, pending, ready, taken, pebble, dust) per prd003 R2\n7. Implement Crumb entity methods: SetState (validates state), Pebble (requires taken), Dust (from any state) per prd003 R4\n8. Implement Crumb property methods: SetProperty, GetProperty, GetProperties, ClearProperty per prd003 R5 (defer full validation to Table.Set per R5.7)\n9. Define Trail struct per prd006 (TrailID, State, CreatedAt, CompletedAt)\n10. Define trail state constants and lifecycle methods (Complete, Abandon)\n11. Define Property struct per prd004, Category struct per prd004\n12. Define Metadata struct per prd005\n13. Define Link struct per prd007 with link type constants (belongs_to, child_of, branches_from, scoped_to)\n14. Define Stash struct and StashHistory struct per prd008\n15. Define Filter type alias (map[string]any) per prd003 R9\n16. Add standard table name constants per prd001 R2.5\n17. Write unit tests for all entity methods: state transitions, property methods, validation, error cases\n\n## Design Decisions\n- All types go in pkg/types/ (shared public API per go-style rule)\n- Entity methods modify struct fields in memory; callers persist via Table.Set (ORM pattern per ARCHITECTURE Decision 9)\n- State is stored as string, not Go enum, for JSON compatibility (prd003 R2.4)\n- Properties map is map[string]any (property_id to value) per prd003 R1.6\n- Trail membership is NOT a Crumb field; use links table (prd003 R1.4)\n- UUID v7 generation is backend responsibility (prd001 R8.2), not in types package\n- Property validation in SetProperty can defer full validation to Table.Set for simplicity (prd003 R5.7)\n- Use sentinel errors checkable with errors.Is (prd001 R7)\n\n## Acceptance Criteria\n- [ ] Config struct defined with Backend, DataDir; Validate() returns appropriate errors\n- [ ] Cupboard interface defined with GetTable, Attach, Detach signatures\n- [ ] Table interface defined with Get(string)(any,error), Set(string,any)(string,error), Delete(string)error, Fetch(map[string]any)([]any,error)\n- [ ] All sentinel errors defined and checkable with errors.Is\n- [ ] Crumb struct with all fields; SetState validates state values; Pebble requires taken state; Dust works from any state\n- [ ] Trail struct with Complete/Abandon methods\n- [ ] Property, Category, Metadata, Link, Stash, StashHistory structs defined\n- [ ] Standard table name constants and link type constants defined\n- [ ] Unit tests pass for all entity methods and validation logic\n- [ ] go build ./... succeeds\n- [ ] go vet ./... passes\n- [ ] Target: ~400-600 lines production code, ~300-500 lines test code","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T14:20:26.568886-05:00","created_by":"petardjukic","updated_at":"2026-02-11T14:20:26.568886-05:00"}
