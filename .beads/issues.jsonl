{"id":"generation-2026-02-11-19-21-7he","title":"Add unit tests for pkg/types (prd001-cupboard-core R1, R7-R8)","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config validation R1.2-R1.4, error types R7, UUID v7 R8)\n- docs/specs/use-cases/rel01.0-uc001-cupboard-lifecycle.yaml (S1: Config creation, S3: ErrAlreadyAttached, S5: ErrTableNotFound)\n- docs/specs/test-suites/test-rel01.0-uc001-cupboard-lifecycle.yaml (test case patterns)\n- pkg/types/ (all files created by issue w84)\n- .claude/rules/go-style.md (table-driven tests, test helpers, testing section)\n\n## Files to Create/Modify\n- pkg/types/config_test.go (create) — Config struct construction and validation error tests\n- pkg/types/ids_test.go (create) — UUID v7 generation tests (format, uniqueness, time-ordering)\n- pkg/types/errors_test.go (create) — Sentinel error identity tests (errors.Is compatibility)\n- pkg/types/entities_test.go (create) — Entity struct construction tests (zero values, field assignment)\n\n## Requirements\n1. Test Config struct field assignment: Backend and DataDir populate correctly\n2. Test that all config validation errors are distinct sentinel errors compatible with errors.Is\n3. Test NewID() generates valid UUID v7 strings: correct format (8-4-4-4-12 hex), version nibble is 7, variant bits are correct\n4. Test NewID() generates unique IDs across 1000 calls (no duplicates)\n5. Test NewID() generates time-ordered IDs: IDs generated later sort lexicographically after earlier ones\n6. Test all cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound) are distinct and work with errors.Is and fmt.Errorf wrapping\n7. Test all table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData) are distinct and work with errors.Is\n8. Test all entity method errors (15 vars per R7.3) are distinct sentinel errors\n9. Test entity struct construction: Crumb, Trail, Property, Category, Metadata, Link, Stash can be instantiated with field assignment and zero values are safe\n10. Test standard table name constants exist and have expected string values\n\n## Design Decisions\n- Use table-driven tests per go-style rule\n- Use testify/assert for assertions (consistent with go-style ecosystem packages)\n- One test file per source file (config_test.go tests config.go, etc.)\n- No mocks needed — these are pure unit tests on types and functions\n- Test error wrapping: wrap each sentinel with fmt.Errorf and verify errors.Is still matches\n\n## Acceptance Criteria\n- [ ] go test ./pkg/types/ passes with all tests green\n- [ ] Config struct fields tested\n- [ ] All 5 config validation errors tested for distinctness and errors.Is\n- [ ] NewID() tested for format, uniqueness (1000 calls), and time ordering\n- [ ] All 3 cupboard lifecycle errors tested\n- [ ] All 3 table operation errors tested\n- [ ] All 15 entity method errors tested for distinctness\n- [ ] All 7 entity structs instantiation tested\n- [ ] Standard table name constants tested\n- [ ] go vet ./pkg/types/ passes","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T19:27:24.787539-05:00","created_by":"petardjukic","updated_at":"2026-02-11T19:27:24.787539-05:00"}
{"id":"generation-2026-02-11-19-21-w84","title":"Define core types and interfaces (prd001-cupboard-core R1-R3, R7-R8)","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, error types, UUID v7)\n- docs/ARCHITECTURE.md § System Overview, § Main Interfaces, § Project Structure\n- docs/specs/use-cases/rel01.0-uc001-cupboard-lifecycle.yaml (validates these types)\n- .claude/rules/go-style.md (naming, project structure, interface design)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct, config validation errors (R1)\n- pkg/types/cupboard.go (create) — Cupboard interface (R2)\n- pkg/types/table.go (create) — Table interface, table operation errors, entity method errors (R3, R7.2, R7.3)\n- pkg/types/errors.go (create) — Cupboard lifecycle errors: ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound (R7.1)\n- pkg/types/ids.go (create) — UUID v7 generation helper using google/uuid (R8)\n- pkg/types/entities.go (create) — Forward-declare entity structs (Crumb, Trail, Property, Category, Metadata, Link, Stash) with fields from their respective PRDs (prd003 R1, prd004 R1-R2, prd005 R1, prd006 R1, prd007 R1, prd008 R1). Include standard table name constants.\n- go.mod (modify) — Add google/uuid dependency\n\n## Requirements\n1. Define Config struct with Backend (string) and DataDir (string) fields (R1.1)\n2. Define config validation errors: ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid (R1.4)\n3. Define Cupboard interface with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error (R2.2)\n4. Define Table interface with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error) (R3.1)\n5. Define standard table name constants: crumbs, trails, properties, metadata, links, stashes (R2.5)\n6. Define cupboard lifecycle errors: ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound (R7.1)\n7. Define table operation errors: ErrNotFound, ErrInvalidID, ErrInvalidData (R7.2)\n8. Define entity method errors: ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter (R7.3)\n9. Define NewID() function that generates UUID v7 (R8.1, R8.2) using google/uuid\n10. Define entity structs with fields per their PRDs: Crumb (prd003 R1), Trail (prd006 R1), Property (prd004 R1), Category (prd004 R2), Metadata (prd005 R1), Link (prd007 R1), Stash (prd008 R1). Include all fields from the PRDs. These are data structs only — entity methods (SetState, Pebble, etc.) will be added in later tasks.\n\n## Design Decisions\n- All types live in pkg/types/ (shared public API per go-style rule)\n- No implementation in pkg/ — only types, interfaces, and constants\n- Entity structs use time.Time for timestamps, map[string]any for Properties on Crumb\n- Errors are package-level sentinel vars compatible with errors.Is\n- One file per concern: config.go, cupboard.go, table.go, errors.go, ids.go, entities.go\n- Add package-level doc comment linking to prd001-cupboard-core per code-prd-architecture-linking rule\n\n## Acceptance Criteria\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Cupboard interface has GetTable, Attach, Detach methods with correct signatures\n- [ ] Table interface has Get, Set, Delete, Fetch methods with correct signatures\n- [ ] All 6 standard table name constants defined\n- [ ] All cupboard lifecycle errors defined (3 vars)\n- [ ] All table operation errors defined (3 vars)\n- [ ] All entity method errors defined (15 vars)\n- [ ] All config validation errors defined (5 vars)\n- [ ] NewID() generates valid UUID v7 strings\n- [ ] All 7 entity structs defined with fields matching their PRDs\n- [ ] go build ./pkg/types/ compiles without errors\n- [ ] go vet ./pkg/types/ passes\n- [ ] Package doc comments reference prd001-cupboard-core","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T19:25:00.104099-05:00","created_by":"petardjukic","updated_at":"2026-02-11T19:30:07.604885-05:00","closed_at":"2026-02-11T19:30:07.604885-05:00","close_reason":"Closed"}
