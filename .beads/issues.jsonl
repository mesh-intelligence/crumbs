{"id":"generation-2026-02-25-23-27-34-0i9","title":"Write PRD prd011-blazes-templates: Template Schema, Discovery, and Selection","description":"deliverable_type: documentation\nformat_rule: prd-format\n\nrequired_reading:\n  - docs/VISION.yaml (implementation_phases phase 99.0 -- blazes mentioned as unscheduled deliverable)\n  - docs/ARCHITECTURE.yaml (project_structure, design_decisions -- understand where blazes fits)\n  - docs/specs/use-cases/rel99.0-uc001-blazes-templates.yaml (the use case this PRD must support)\n  - docs/specs/test-suites/test-rel99.0.yaml (test cases S1-S21 that validate blazes discovery and selection)\n  - docs/specs/product-requirements/prd001-cupboard-core.yaml (Cupboard interface pattern to follow)\n  - docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct fields referenced in templates)\n  - docs/specs/product-requirements/prd006-trails-interface.yaml (Trail creation and belongs_to links for future instantiation context)\n  - docs/SPECIFICATIONS.yaml (prd_index and use_case_index -- understand how PRDs are indexed)\n\nfiles:\n  - path: docs/specs/product-requirements/prd011-blazes-templates.yaml\n    action: create\n    note: PRD defining the Blaze template schema, discovery mechanism, matching algorithm, and parameter extraction\n\nrequired_sections:\n  - \"Problem: agents need reusable workflow patterns but currently construct workflows from scratch each time\"\n  - \"Goals: G1 define the Blaze template YAML schema, G2 define the BlazeParameter schema, G3 specify template directory discovery, G4 specify template listing and metadata parsing, G5 specify task-to-template matching via tags, G6 specify template selection when multiple match, G7 specify parameter extraction and context inference, G8 document error handling for malformed templates and missing directories\"\n  - \"Requirements: R1 Blaze Template Schema (file format, required and optional fields), R2 BlazeParameter Schema (name, description, type, default), R3 Template Directory Discovery (well-known path .crumbs/blazes/, configurable path), R4 Template Listing (enumerate .yaml/.yml files), R5 Metadata Parsing (extract name, description, tags, parameters without parsing full trail definition), R6 Tag-Based Matching (semantic match of task context against template tags), R7 Template Selection (single match, multiple match with specificity, user prompt for ties), R8 Parameter Extraction (required vs optional, type, default values, context inference), R9 Error Handling (missing directory, empty directory, malformed YAML, permission denied)\"\n  - \"Non-Goals: trail instantiation from templates, parameter value binding and placeholder expansion, creating crumbs or trails from templates, template versioning or inheritance, remote template repositories, template creation or editing workflows\"\n  - \"Acceptance Criteria: checkable outcomes for each requirement\"\n\nrequirements:\n  - id: R1\n    text: \"Define the Blaze template YAML schema with required fields (name, description, tags, parameters, trail_definition) and optional fields. The schema must be sufficient for the discovery and selection flow in rel99.0-uc001-blazes-templates without requiring instantiation support. Anchor to use case touchpoints T1-T4.\"\n  - id: R2\n    text: \"Define the BlazeParameter schema with fields name (string, required), description (string, required), type (string: text, integer, boolean, list -- required), and default (any, optional). Anchor to use case success criteria S6 (agent extracts parameter definitions).\"\n  - id: R3\n    text: \"Specify template directory discovery: well-known path .crumbs/blazes/ relative to the cupboard data directory, configurable via Cupboard configuration or a dedicated setting. Anchor to use case flow F1 and test cases 'Discover template directory at well-known path' and 'Discover template directory at configured path'.\"\n  - id: R4\n    text: \"Specify template listing: enumerate all .yaml and .yml files in the template directory, handling empty directories and missing directories gracefully. Anchor to use case flow F2 and test cases 'List all YAML files in template directory', 'Handle empty template directory', 'Handle missing template directory gracefully'.\"\n  - id: R5\n    text: \"Specify metadata parsing: extract name, description, tags, and parameters from each template YAML file without parsing the full trail definition section. Malformed templates are skipped with a warning. Anchor to use case flow F3 and test cases 'Parse template metadata successfully', 'Parse template with minimal metadata', 'Skip malformed template with warning'.\"\n  - id: R6\n    text: \"Specify tag-based matching: compare task context (description, labels, keywords) against template tags for semantic matching. Define what constitutes an exact match vs semantic match. Anchor to use case flow F4 and test cases 'Match task to template tags (exact match)', 'Match task to template tags (semantic match)', 'No match when no templates have relevant tags'.\"\n  - id: R7\n    text: \"Specify template selection: when one template matches, select it; when multiple match, select by specificity (most matching tags); when equally specific, prompt user or use priority. Anchor to use case flow F5 and test cases 'Select single matching template', 'Select most specific template when multiple match', 'Prompt user when multiple templates match equally'.\"\n  - id: R8\n    text: \"Specify parameter extraction: identify required parameters (no default) vs optional (has default), determine which can be inferred from the current task context, and which require user input. Anchor to use case flow F6-F7 and test cases 'Extract parameter definitions with all fields', 'Extract parameters with defaults', 'Identify parameters that can be inferred from context'.\"\n\ndesign_decisions:\n  - id: D1\n    text: \"Follow the existing PRD format established by prd001 through prd010. Use the same section structure: Problem, Goals, Requirements (numbered R1-RN with sub-items R1.1, R1.2), Non-Goals, Acceptance Criteria.\"\n  - id: D2\n    text: \"The Blaze template schema is a YAML file format specification, not a Go struct definition. Go structs will be defined in a subsequent code task. The PRD specifies the contract.\"\n  - id: D3\n    text: \"Template discovery and selection are read-only operations on the filesystem. They do not modify Cupboard state. The PRD must clearly separate discovery/selection (this PRD) from instantiation (future prd-blazes-instantiation).\"\n  - id: D4\n    text: \"Error handling follows the existing sentinel error pattern from prd001-cupboard-core R7. Define error types for template operations: ErrTemplateNotFound, ErrTemplateDirNotFound, ErrMalformedTemplate, ErrNoMatch.\"\n  - id: D5\n    text: \"The PRD must be consistent with the existing use case rel99.0-uc001-blazes-templates and test suite test-rel99.0. Every use case success criterion (S1-S7) must map to at least one PRD requirement.\"\n\nacceptance_criteria:\n  - id: AC1\n    text: \"File docs/specs/product-requirements/prd011-blazes-templates.yaml exists and is valid YAML\"\n  - id: AC2\n    text: \"Problem section explains why agents need reusable workflow templates and why the current approach (constructing workflows from scratch) is insufficient\"\n  - id: AC3\n    text: \"Goals section lists G1-G8 covering template schema, parameter schema, discovery, listing, parsing, matching, selection, and error handling\"\n  - id: AC4\n    text: \"Requirements section has numbered requirements R1-R9+ with sub-items, each anchored to specific use case flows (F1-F7) and test cases from test-rel99.0\"\n  - id: AC5\n    text: \"Blaze template YAML schema is fully specified with field names, types, required/optional status, and an example template file\"\n  - id: AC6\n    text: \"BlazeParameter schema is fully specified with name, description, type, and default fields\"\n  - id: AC7\n    text: \"Non-Goals section explicitly excludes trail instantiation, parameter binding, template versioning, remote repositories, and template creation/editing\"\n  - id: AC8\n    text: \"Every use case success criterion (S1-S7 from rel99.0-uc001) maps to at least one PRD requirement\"\n  - id: AC9\n    text: \"Error types are defined following the sentinel error pattern from prd001-cupboard-core\"\n  - id: AC10\n    text: \"Acceptance criteria in the PRD are checkable and specific, not vague\"","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T04:29:50Z","created_by":"petardjukic","updated_at":"2026-02-26T04:34:48Z","closed_at":"2026-02-26T04:34:48Z","close_reason":"Closed","comments":[{"id":1,"issue_id":"generation-2026-02-25-23-27-34-0i9","author":"petardjukic","text":"{\"caller\":\"measure\",\"started_at\":\"2026-02-26T04:29:50Z\",\"duration_s\":0,\"tokens\":{\"input\":141666,\"output\":5880,\"cache_creation\":126070,\"cache_read\":15594,\"cost_usd\":0.9427445},\"loc_before\":{\"production\":0,\"test\":0},\"loc_after\":{\"production\":0,\"test\":0},\"diff\":{\"files\":0,\"insertions\":0,\"deletions\":0}}","created_at":"2026-02-26T04:29:51Z"},{"id":4,"issue_id":"generation-2026-02-25-23-27-34-0i9","author":"petardjukic","text":"{\"caller\":\"stitch\",\"started_at\":\"2026-02-26T04:29:56Z\",\"duration_s\":291,\"tokens\":{\"input\":1730739,\"output\":11645,\"cache_creation\":169731,\"cache_read\":1560991,\"cost_usd\":3.1618815},\"loc_before\":{\"production\":0,\"test\":0},\"loc_after\":{\"production\":0,\"test\":0},\"diff\":{\"files\":1,\"insertions\":366,\"deletions\":0}}","created_at":"2026-02-26T04:34:48Z"}]}
{"id":"generation-2026-02-25-23-27-34-ahx","title":"measure: plan on generation-2026-02-25-23-27-34 at 8e8c62e0","description":"Measure invocation.\n\nBranch: generation-2026-02-25-23-27-34\nCommit: 8e8c62e01e519bb8a6f93601e0e9af41729a4372\nExisting issues: 0\nMax new issues: 1","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T04:27:50Z","created_by":"petardjukic","updated_at":"2026-02-26T04:29:53Z","closed_at":"2026-02-26T04:29:53Z","close_reason":"Closed","comments":[{"id":2,"issue_id":"generation-2026-02-25-23-27-34-ahx","author":"petardjukic","text":"{\"caller\":\"measure\",\"started_at\":\"2026-02-26T04:27:51Z\",\"duration_s\":122,\"tokens\":{\"input\":141666,\"output\":5880,\"cache_creation\":126070,\"cache_read\":15594,\"cost_usd\":0.9427445},\"loc_before\":{\"production\":0,\"test\":0},\"loc_after\":{\"production\":0,\"test\":0},\"diff\":{\"files\":0,\"insertions\":0,\"deletions\":0}}","created_at":"2026-02-26T04:29:52Z"},{"id":3,"issue_id":"generation-2026-02-25-23-27-34-ahx","author":"petardjukic","text":"issues_created: 1, status: success","created_at":"2026-02-26T04:29:52Z"}]}
