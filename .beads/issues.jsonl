{"id":"generation-2026-02-11-21-30-20-3oj","title":"Define shared types and interfaces in pkg/types (prd001-cupboard-core R1-R3, R7-R8)","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, error types, UUID v7)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct fields, state values)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct fields, state values)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property, Category struct fields)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct fields)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct fields, link types)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct fields, stash types)\n- docs/ARCHITECTURE.md § Main Interfaces, § System Components, § Design Decisions\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (compile-time validation criteria)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct, config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid)\n- pkg/types/cupboard.go (create) — Cupboard interface (GetTable, Attach, Detach), cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) — Table interface (Get, Set, Delete, Fetch), table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n- pkg/types/tables.go (create) — Standard table name constants (CrumbsTable, TrailsTable, PropertiesTable, MetadataTable, LinksTable, StashesTable), StandardTableNames slice\n- pkg/types/crumb.go (create) — Crumb struct with fields (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties), crumb state constants (StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust)\n- pkg/types/trail.go (create) — Trail struct with fields (TrailID, State, CreatedAt, CompletedAt), trail state constants (TrailDraft, TrailPending, TrailActive, TrailCompleted, TrailAbandoned)\n- pkg/types/property.go (create) — Property struct (PropertyID, Name, ValueType, CreatedAt) and Category struct (CategoryID, PropertyID, Name, Ordinal)\n- pkg/types/metadata.go (create) — Metadata struct (MetadataID, CrumbID, SchemaName, Content, CreatedAt)\n- pkg/types/link.go (create) — Link struct (LinkID, LinkType, FromID, ToID, CreatedAt), link type constants (LinkBelongsTo, LinkChildOf, LinkBranchesFrom, LinkScopedTo)\n- pkg/types/stash.go (create) — Stash struct (StashID, Name, StashType, Value, Version, HolderID, CreatedAt, UpdatedAt)\n\n## Requirements\n- Define Config struct per prd001-cupboard-core R1.1 with Backend (string) and DataDir (string) fields\n- Define all config validation errors per R1.4\n- Define Cupboard interface per R2.2 with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error\n- Define Table interface per R3.1 with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error)\n- Define all standard error types per R7.1 (cupboard lifecycle), R7.2 (table operations), R7.3 (entity methods)\n- Define standard table name constants per R2.5 and a StandardTableNames slice for enumeration\n- Define all seven entity structs with fields from their respective PRDs: Crumb (prd003 R1.1), Trail (prd006), Property and Category (prd004), Metadata (prd005), Link (prd007), Stash (prd008)\n- Define state constants for Crumb (draft, pending, ready, taken, pebble, dust) and Trail (draft, pending, active, completed, abandoned)\n- Define link type constants (belongs_to, child_of, branches_from, scoped_to)\n- All types must use time.Time for timestamps and string for IDs (UUID v7 per R8)\n- No entity methods yet (those are implementation tasks); only struct definitions and constants\n\n## Design Decisions\n- All types go in pkg/types/ as the shared contract layer between components (per go-style rule and ARCHITECTURE)\n- Interfaces accept and return any; callers use type assertions (per prd001 R3.6)\n- Error sentinels use errors.New for compatibility with errors.Is (per prd001 constraints)\n- State and link type values are string constants, not enums, for JSON compatibility (per prd003 R2.4)\n- No methods on entity structs in this task; entity methods (SetState, Pebble, Dust, etc.) are separate tasks\n\n## Acceptance Criteria\n- [ ] go build ./pkg/types/ compiles without errors\n- [ ] go build ./cmd/cupboard compiles without errors\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Cupboard interface has GetTable, Attach, Detach methods with correct signatures\n- [ ] Table interface has Get, Set, Delete, Fetch methods with correct signatures\n- [ ] All 6 standard table name constants defined\n- [ ] All 7 entity structs defined with fields matching their PRDs\n- [ ] All error sentinels from R7.1, R7.2, R7.3, and R1.4 defined\n- [ ] Crumb state constants defined (6 states)\n- [ ] Trail state constants defined (5 states)\n- [ ] Link type constants defined (4 types)\n- [ ] go vet ./pkg/types/ passes","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:33:00.361957-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:33:00.361957-05:00"}
