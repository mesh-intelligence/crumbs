{"id":"main-p9z","title":"Implement core types and interfaces (pkg/types)","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, error types, UUID v7)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct, state values, state transition methods)\n- docs/ARCHITECTURE.md ยง Main Interfaces, ยง Entity Types, ยง Design Decisions\n- docs/specs/use-cases/rel01.0-uc001-cupboard-lifecycle.yaml (lifecycle flow)\n- docs/specs/use-cases/rel01.0-uc003-crumb-lifecycle.yaml (crumb state machine)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct with Backend and DataDir fields, validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid), Validate() method\n- pkg/types/cupboard.go (create) - Cupboard interface (GetTable, Attach, Detach), lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) - Table interface (Get, Set, Delete, Fetch), Filter type alias, table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter), standard table name constants\n- pkg/types/crumb.go (create) - Crumb struct (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties), state constants (draft, pending, ready, taken, pebble, dust), state transition methods (SetState, Pebble, Dust), property methods (SetProperty, GetProperty, GetProperties, ClearProperty)\n- pkg/types/trail.go (create) - Trail struct (TrailID, State, CreatedAt, CompletedAt), state constants\n- pkg/types/property.go (create) - Property struct (PropertyID, Name, Description, ValueType, CreatedAt), Category struct, value type constants\n- pkg/types/metadata.go (create) - Metadata struct (MetadataID, CrumbID, TableName, Content, PropertyID, CreatedAt), Schema struct\n- pkg/types/link.go (create) - Link struct (LinkID, LinkType, FromID, ToID, CreatedAt), link type constants\n- pkg/types/stash.go (create) - Stash struct (StashID, Name, StashType, Value, Version, CreatedAt), StashHistoryEntry, stash type and operation constants\n- pkg/types/doc.go (create) - Package documentation referencing implemented PRDs\n- pkg/types/config_test.go (create) - Config validation tests\n- pkg/types/crumb_test.go (create) - Crumb state transition and property method tests\n\n## Requirements\n- Implement prd001-cupboard-core R1 (Config struct and validation), R2 (Cupboard interface), R3 (Table interface), R7 (standard error types), R8 (UUID v7 requirement documented)\n- Implement prd003-crumbs-interface R1 (Crumb struct), R2 (state values), R4 (state transition methods: SetState validates state values, Pebble requires taken state, Dust from any state), R5 (property access methods: SetProperty, GetProperty, GetProperties, ClearProperty)\n- Define all entity structs from their respective PRDs (Trail from prd006, Property/Category from prd004, Metadata from prd005, Link from prd007, Stash from prd008) so that Table interface returns concrete types\n- Standard table name constants: crumbs, trails, properties, metadata, links, stashes\n- Filter type alias: map[string]any\n\n## Design Decisions\n- All types go in pkg/types (shared public API, no implementation)\n- Interfaces accept and return `any` per prd001 R3; callers type-assert to concrete structs\n- Entity methods (SetState, Pebble, etc.) modify struct fields in memory; caller persists with Table.Set\n- Property methods that need property definitions (SetProperty validation) defer validation to Table.Set per prd003 R5.7\n- UUID v7 generation is a backend concern, not a types concern; types only document the requirement\n- Use time.Time for timestamps, string for states, map[string]any for Properties and Filter\n\n## Acceptance Criteria\n- [ ] Config struct compiles with Backend and DataDir fields\n- [ ] Config.Validate() returns ErrBackendEmpty for empty backend, ErrBackendUnknown for unrecognized backend\n- [ ] Cupboard interface compiles with GetTable, Attach, Detach signatures\n- [ ] Table interface compiles with Get(string)(any,error), Set(string,any)(string,error), Delete(string)error, Fetch(map[string]any)([]any,error)\n- [ ] Crumb struct compiles with all R1.1 fields\n- [ ] SetState returns ErrInvalidState for unknown states, succeeds for valid states, is idempotent\n- [ ] Pebble returns ErrInvalidTransition when state is not taken, succeeds from taken\n- [ ] Dust succeeds from any state, is idempotent\n- [ ] All entity structs (Trail, Property, Category, Metadata, Link, Stash, StashHistoryEntry) compile\n- [ ] All sentinel errors defined and checkable with errors.Is\n- [ ] Tests pass: go test ./pkg/types/...\n- [ ] go build ./cmd/cupboard succeeds\n- [ ] Estimated size: ~400 LOC production, ~300 LOC tests","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T14:11:58.332334-05:00","created_by":"petardjukic","updated_at":"2026-02-11T14:11:58.332334-05:00"}
