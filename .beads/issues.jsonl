{"id":"generation-2026-02-11-21-37-14-k3d","title":"Define Cupboard and Table interfaces with standard table name constants","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R2: Cupboard interface, R3: Table interface, R4: Attach, R5: Detach, R6: post-detach errors)\n- docs/ARCHITECTURE.md § Main Interfaces, § System Components\n- pkg/types/config.go (Config struct from task 0)\n- pkg/types/errors.go (sentinel errors from task 0)\n- .claude/rules/go-style.md (interface design, when to introduce interfaces)\n\n## Files to Create/Modify\n- pkg/types/cupboard.go (create) — Cupboard interface with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error; standard table name constants (TableCrumbs, TableTrails, TableProperties, TableMetadata, TableLinks, TableStashes); StandardTableNames slice for iteration\n- pkg/types/table.go (create) — Table interface with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error)\n- pkg/types/cupboard_test.go (create) — Compile-time interface satisfaction checks (verify that a mock struct can satisfy Cupboard and Table interfaces); tests for standard table name constants (all 6 present, no duplicates)\n\n## Requirements\n- Define Cupboard interface per prd001 R2.1–R2.6 with exactly three methods: GetTable, Attach, Detach\n- Define Table interface per prd001 R3.1–R3.7 with exactly four methods: Get, Set, Delete, Fetch\n- Define standard table name constants per prd001 R2.5 (crumbs, trails, properties, metadata, links, stashes)\n- Define StandardTableNames as a slice of all table names for iteration and validation\n- Add package-level comment linking to prd001-cupboard-core\n- Set and Get use `any` type per prd001 R3.6 (callers type-assert to concrete structs)\n\n## Design Decisions\n- Interfaces in pkg/types/ (shared contract layer); implementations in internal/sqlite/\n- Table name constants as exported string constants\n- StandardTableNames as a package-level var (slice) for backends to iterate during validation\n- No implementation in this task; interfaces and constants only\n- Table.Set returns (string, error) per prd001 R3.3 — returns actual ID (generated or provided)\n\n## Acceptance Criteria\n- [ ] Cupboard interface defined with GetTable, Attach, Detach methods\n- [ ] Table interface defined with Get, Set, Delete, Fetch methods\n- [ ] Set returns (string, error) not just error\n- [ ] 6 table name constants defined matching prd001 R2.5\n- [ ] StandardTableNames slice contains all 6 names\n- [ ] Compile-time interface checks pass\n- [ ] go build ./... succeeds\n- [ ] Package comment references prd001-cupboard-core","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:40:19.831409-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:40:19.831409-05:00","dependencies":[{"issue_id":"generation-2026-02-11-21-37-14-k3d","depends_on_id":"generation-2026-02-11-21-37-14-roi","type":"blocks","created_at":"2026-02-11T21:40:19.948452-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-11-21-37-14-roi","title":"Define core types: Config, Crumb struct, error sentinels, and Filter type alias","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R1: Config, R7: error types, R8: UUID v7)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R1: Crumb struct, R2: state values, R4: state transition methods, R9: Filter type)\n- docs/ARCHITECTURE.md § System Overview, § Main Interfaces\n- .claude/rules/go-style.md (project structure, naming, error handling)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct with Backend, DataDir fields; config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid); Validate() method\n- pkg/types/errors.go (create) — Cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound); Table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData); Entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n- pkg/types/crumb.go (create) — Crumb struct (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties); state constants (StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust); state transition methods (SetState, Pebble, Dust); property methods (SetProperty, GetProperty, GetProperties, ClearProperty); Filter type alias\n- pkg/types/crumb_test.go (create) — Tests for Crumb state transitions (SetState valid/invalid, Pebble from taken/non-taken, Dust from any state, idempotency); tests for property methods (SetProperty, GetProperty, GetProperties, ClearProperty); tests for Config.Validate()\n\n## Requirements\n- Define Config struct per prd001 R1.1–R1.4 with Validate() method\n- Define all sentinel errors per prd001 R7.1–R7.3, compatible with errors.Is\n- Define Crumb struct per prd003 R1.1–R1.6\n- Define state constants per prd003 R2.1–R2.5\n- Implement state transition methods per prd003 R4.1–R4.5 (SetState validates state values, Pebble requires taken state, Dust from any state)\n- Implement property methods per prd003 R5.1–R5.6 (property methods that require definition lookup defer validation; simple map operations only at entity level)\n- Define Filter type alias as map[string]any per prd003 R9.1\n- Add package-level comment linking to implemented PRDs\n\n## Design Decisions\n- State constants as exported string constants (not iota) for JSON compatibility per prd003 R2.4\n- Property validation deferred to Table.Set per prd003 R5.7 (simpler: entity methods do map operations only)\n- Crumb struct methods modify in-memory only; caller persists via Table.Set per prd003 R4.5\n- Use google/uuid for UUID v7 generation (add to go.mod)\n\n## Acceptance Criteria\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Config.Validate() returns correct errors for empty/unknown backend and empty DataDir\n- [ ] All 19 sentinel errors defined and work with errors.Is\n- [ ] Crumb struct has all 6 fields per prd003 R1.1\n- [ ] 6 state constants defined (draft, pending, ready, taken, pebble, dust)\n- [ ] SetState validates state values and returns ErrInvalidState for unknown states\n- [ ] Pebble returns ErrInvalidTransition when not in taken state\n- [ ] Dust succeeds from any state and is idempotent\n- [ ] Property methods (Get/Set/Clear/GetAll) operate on the Properties map\n- [ ] Filter type alias defined\n- [ ] Tests pass for all state transitions and property operations\n- [ ] go build ./... succeeds","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:40:19.694845-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:43:22.09241-05:00","closed_at":"2026-02-11T21:43:22.09241-05:00","close_reason":"Closed"}
