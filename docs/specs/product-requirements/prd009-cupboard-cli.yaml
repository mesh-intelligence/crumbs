id: prd009-cupboard-cli
title: Cupboard CLI Interface
problem: |
  The CLI design is scattered across multiple documents. prd001-cupboard-core defines the Cupboard and Table interfaces but does not specify CLI commands. prd010-configuration-directories defines configuration flags but not command structure. prd003-crumbs-interface defines the Crumb entity but not crumb-specific CLI commands. eng02-beads-migration lists issue-tracking commands but not their full specification.

  Agents building the CLI must read four documents and infer the CLI contract. Without a single specification, implementations diverge on command naming, flag conventions, output formats, and error handling. We need one document that defines the complete CLI interface so developers and agents can implement commands consistently.
goals:
- id: G1
  goal: Consolidate all CLI commands into one specification
- id: G2
  goal: Define generic table commands that expose the Table interface
- id: G3
  goal: Define crumb-specific commands with entity-aware flags
- id: G4
  goal: Define issue-tracking commands for the beads migration
- id: G5
  goal: Specify output formats for human-readable and JSON modes
- id: G6
  goal: Define exit codes and error message conventions
- id: G7
  goal: Document global flags for configuration and data directory overrides
requirements:
- group: R1
  title: Command Structure
  items:
  - id: R1.1
    requirement: The CLI executable must be named "cupboard"
  - id: R1.2
    requirement: Commands must follow a two-tier structure
  - id: R1.3
    requirement: Generic table commands (get, set, delete, list) must accept any table
      name and work uniformly across all tables
  - id: R1.4
    requirement: Entity-specific commands (crumb, trail, etc.) must provide friendly
      flags and validation for that entity type
  - id: R1.5
    requirement: The CLI must use cobra for command parsing and viper for configuration
      management
- group: R2
  title: Root Commands
  items:
  - id: R2.1
    requirement: cupboard init must initialize the cupboard storage and print confirmation
  - id: R2.2
    requirement: cupboard version must print the version string
- group: R3
  title: Generic Table Commands
  items:
  - id: R3.1
    requirement: cupboard get <table> <id> must retrieve an entity by ID from the
      specified table
  - id: R3.2
    requirement: cupboard set <table> <id> <json> must create or update an entity
  - id: R3.3
    requirement: cupboard delete <table> <id> must remove an entity by ID
  - id: R3.4
    requirement: cupboard list <table> [filter...] must query entities with optional
      filters
- group: R4
  title: Crumb Commands
  items:
  - id: R4.1
    requirement: Crumb commands must be grouped under "cupboard crumb"
  - id: R4.2
    requirement: All crumb commands must support the --json flag for JSON output
  - id: R4.3
    requirement: cupboard crumb add must create a new crumb with entity-specific flags
  - id: R4.4
    requirement: cupboard crumb get <id> must retrieve a crumb with human-readable
      or JSON output
  - id: R4.5
    requirement: cupboard crumb list must query crumbs with optional state filter
  - id: R4.6
    requirement: cupboard crumb delete <id> must remove a crumb by ID
- group: R5
  title: Issue-Tracking Commands
  items:
  - id: R5.1
    requirement: Issue-tracking commands must provide parity with the beads (bd) CLI
      for migration purposes
  - id: R5.2
    requirement: cupboard ready must list crumbs that are ready for work
  - id: R5.3
    requirement: cupboard create must create a new crumb with issue-tracking fields
  - id: R5.4
    requirement: cupboard show <id> must display a crumb with full details
  - id: R5.5
    requirement: cupboard update <id> must modify crumb fields
  - id: R5.6
    requirement: cupboard close <id> must transition a crumb to completed state
  - id: R5.7
    requirement: cupboard comments add <id> <text> must add a comment to a crumb
- group: R6
  title: Global Flags
  items:
  - id: R6.1
    requirement: All commands must inherit global flags from the root command
  - id: R6.2
    requirement: --config-dir must override the configuration directory
  - id: R6.3
    requirement: --data-dir must override the data directory
  - id: R6.4
    requirement: --help must print usage information for any command
  - id: R6.5
    requirement: --version (on root command) must be an alias for cupboard version
- group: R7
  title: Output Formats
  items:
  - id: R7.1
    requirement: Commands must support two output modes
  - id: R7.2
    requirement: Human-readable output must use tabwriter for aligned columns
  - id: R7.3
    requirement: JSON output must be pretty-printed with 2-space indentation
  - id: R7.4
    requirement: Error messages must be written to stderr, not stdout
  - id: R7.5
    requirement: Successful output must be written to stdout
  - id: R7.6
    requirement: JSON output for single entities must be an object; for multiple entities
      must be an array
  - id: R7.7
    requirement: Empty results must output an empty array [] in JSON mode, or "No
      <entity> found." in human-readable mode
- group: R8
  title: Exit Codes
  items:
  - id: R8.1
    requirement: The CLI must use the following exit codes
  - id: R8.2
    requirement: Exit code 0 must be returned for successful operations, including
      empty query results
  - id: R8.3
    requirement: Exit code 1 must be returned for user-correctable errors (bad input,
      missing entity)
  - id: R8.4
    requirement: Exit code 2 must be returned for system errors that require investigation
- group: R9
  title: Error Messages
  items:
  - id: R9.1
    requirement: 'Error messages must follow the pattern "context: details"'
  - id: R9.2
    requirement: Error messages must not include stack traces in normal operation
  - id: R9.3
    requirement: Error messages must include the entity ID or table name when relevant
  - id: R9.4
    requirement: Validation errors must explain what was expected
- group: R10
  title: Init Command
  items:
  - id: R10.1
    requirement: cupboard init must initialize the storage backend
  - id: R10.2
    requirement: Init must create the data directory if it does not exist
  - id: R10.3
    requirement: Init must create empty JSONL files if they do not exist
  - id: R10.4
    requirement: Init must seed built-in properties (priority, type, description,
      owner, labels) per prd004-properties-interface R8
  - id: R10.5
    requirement: Init must be idempotent (running init twice must not error or duplicate
      data)
  - id: R10.6
    requirement: Init must print "Cupboard initialized successfully" on completion
non_goals:
- This PRD does not define a graphical user interface (GUI) or terminal user interface
  (TUI)
- This PRD does not define shell completion scripts (bash, zsh, fish)
- This PRD does not define a plugin system for custom commands
- This PRD does not define remote backend support (HTTP, gRPC)
- This PRD does not define batch operations beyond what the generic table commands
  provide
- This PRD does not define interactive mode or REPL functionality
acceptance_criteria:
- id: AC1
  criterion: All implemented commands documented (init, version, get, set, delete,
    list, crumb add/get/list/delete)
- id: AC2
  criterion: All planned issue-tracking commands documented (ready, create, show,
    update, close, comments add)
- id: AC3
  criterion: Generic table commands specify table argument, ID argument, and output
    format
- id: AC4
  criterion: Crumb commands specify entity-specific flags (--name, --state, --limit)
- id: AC5
  criterion: Issue-tracking commands specify flags for beads migration parity (--type,
    --title, --description, --status)
- id: AC6
  criterion: Global flags documented (--config-dir, --data-dir, --help, --version)
- id: AC7
  criterion: Output format specified for each command (human-readable and JSON)
- id: AC8
  criterion: Exit codes defined (0 success, 1 user error, 2 system error)
- id: AC9
  criterion: Error message format defined with examples
- id: AC10
  criterion: Init command behavior documented (directory creation, property seeding,
    idempotence)
