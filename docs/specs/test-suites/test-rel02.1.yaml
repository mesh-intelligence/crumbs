id: test-rel02.1
title: Issue-Tracking and Self-Hosting
release: '02.1'
traces:
- rel02.1-uc001-issue-tracking-cli
- rel02.1-uc002-table-benchmarks
- rel02.1-uc003-self-hosting
- rel02.1-uc004-metadata-lifecycle
preconditions: |-
  Cupboard binary built from cmd/cupboard
  Fresh temp directory for config and data
  Config file points SQLite backend at the temp data directory
  CUPBOARD_CONFIG environment variable set to config file path
  No existing crumbs in the table
  Go test infrastructure available (go test command)
  tests/integration package contains benchmark test files
  Cupboard initialized with SQLite backend in a temp directory
  Built-in properties seeded per prd002-sqlite-backend R9
  No existing crumbs
  Cupboard attached with SQLite backend
  Fresh temp directory for data
  No existing crumbs or metadata
  Built-in schemas (comments, attachments) pre-registered
test_cases:
- name: Create task with JSON output returns crumb_id, state, and type
  description: 'Validates S1: cupboard create --type task --title ''Demo'' --description
    ''Test'' --json outputs JSON with crumb_id, state open, type task. '
  inputs:
    args:
    - cupboard create --type task --title "Demo" --description "Test" --json
  expected:
    exit_code: 0
    stdout_structure: '{"crumb_id": "present", "state": "open", "type": "task", "title":
      "Demo"}'
- name: Create task with required fields in human-readable mode
  inputs:
    args:
    - cupboard create --type task --title "Implement feature" --description "Details
      here"
  expected:
    exit_code: 0
    stdout: Created
- name: List returns JSON array containing created task
  description: 'Validates S2: cupboard list --json returns JSON array containing the
    created task. '
  inputs:
    args:
    - cupboard list --json
  expected:
    exit_code: 0
    stdout_structure: '{"type": "array", "min_length": 1, "items_contain": {"title":
      "Listed task", "type": "task"}}'
- name: List empty cupboard returns empty JSON array
  inputs:
    args:
    - cupboard list --json
  expected:
    exit_code: 0
    stdout_structure: '{"length": 0}'
- name: Show displays title, state, type, and description
  description: 'Validates S3: cupboard show <id> displays title, state, type, and
    description in human-readable format. '
  inputs:
    args:
    - cupboard show ${crumb_id}
  expected:
    exit_code: 0
    stdout: Full details here
- name: Show with JSON output returns full crumb object
  inputs:
    args:
    - cupboard show ${crumb_id} --json
  expected:
    exit_code: 0
    stdout_structure: '{"title": "JSON show", "type": "task", "state": "open", "description":
      "Machine readable"}'
- name: Show nonexistent ID returns error
  inputs:
    args:
    - cupboard show nonexistent-uuid-12345
  expected:
    exit_code: 1
    stderr_contains: not found
- name: Ready returns JSON array including open tasks
  description: 'Validates S4: cupboard ready --json --type task returns JSON array
    including open tasks. '
  inputs:
    args:
    - cupboard ready --json --type task
  expected:
    exit_code: 0
    stdout_structure: '{"type": "array", "min_length": 1, "items_contain": {"title":
      "Ready task", "state": "open", "type": "task"}}'
- name: Ready filters by type
  inputs:
    args:
    - cupboard ready --json --type task
  expected:
    exit_code: 0
    stdout_structure: '{"length": 1, "items": [{"type": "task"}]}'
- name: Ready with limit returns at most n results
  inputs:
    args:
    - cupboard ready -n 2 --json --type task
  expected:
    exit_code: 0
    stdout_structure: '{"max_length": 2}'
- name: Update status to in_progress succeeds with confirmation
  description: 'Validates S5: cupboard update <id> --status in_progress exits with
    code 0 and confirmation message. '
  inputs:
    args:
    - cupboard update ${crumb_id} --status in_progress
  expected:
    exit_code: 0
    stdout: Updated
- name: Update status to in_progress changes state
  inputs:
    args:
    - cupboard update ${crumb_id} --status in_progress
  expected:
    exit_code: 0
- name: Update nonexistent ID fails
  inputs:
    args:
    - cupboard update nonexistent-uuid-12345 --status in_progress
  expected:
    exit_code: 1
    stderr_contains: not found
- name: Ready excludes tasks not in open state
  description: 'Validates S6: cupboard ready --json --type task excludes tasks no
    longer in open state. '
  inputs:
    args:
    - cupboard ready --json --type task
  expected:
    exit_code: 0
    stdout_structure: '{"length": 1, "items": [{"title": "Open task"}]}'
- name: Ready returns empty when all tasks claimed
  inputs:
    args:
    - cupboard ready --json --type task
  expected:
    exit_code: 0
    stdout_structure: '{"length": 0}'
- name: Comments add exits with confirmation
  description: 'Validates S7: cupboard comments add <id> ''text'' exits with code
    0 and confirmation message. '
  inputs:
    args:
    - 'cupboard comments add ${crumb_id} "tokens: 34256"'
  expected:
    exit_code: 0
    stdout: Added
- name: Comments add to nonexistent ID fails
  inputs:
    args:
    - cupboard comments add nonexistent-uuid-12345 "orphan comment"
  expected:
    exit_code: 1
    stderr_contains: not found
- name: Show includes comment text in output
  description: 'Validates S8: cupboard show <id> includes comment text in output. '
  inputs:
    args:
    - cupboard show ${crumb_id}
  expected:
    exit_code: 0
    stdout: 'Work session note: completed review'
- name: Show includes multiple comments
  inputs:
    args:
    - cupboard show ${crumb_id}
  expected:
    exit_code: 0
    stdout: Second comment
- name: Close exits with confirmation
  description: 'Validates S9: cupboard close <id> exits with code 0 and confirmation
    message. '
  inputs:
    args:
    - cupboard close ${crumb_id}
  expected:
    exit_code: 0
    stdout: Closed
- name: Close nonexistent ID fails
  inputs:
    args:
    - cupboard close nonexistent-uuid-12345
  expected:
    exit_code: 1
    stderr_contains: not found
- name: Show confirms state is closed after close command
  description: 'Validates S10: cupboard show <id> shows state as closed after close
    command. '
  inputs:
    args:
    - cupboard show ${crumb_id}
  expected:
    exit_code: 0
    stdout: closed
- name: Show with JSON confirms closed state
  inputs:
    args:
    - cupboard show ${crumb_id} --json
  expected:
    exit_code: 0
    stdout_structure: '{"state": "closed"}'
- name: Ready excludes closed tasks
  inputs:
    args:
    - cupboard ready --json --type task
  expected:
    exit_code: 0
    stdout_structure: '{"length": 1, "items": [{"title": "Open for work"}]}'
- name: Full issue-tracking workflow
  description: 'Exercises the complete flow from F1-F14 in the use case: create task,
    verify with list and show, claim with update, add comment, close, and confirm
    final state. '
  inputs: {}
  expected:
    exit_code: 0
- name: Create epic with labels
  description: 'Validates F4 from use case: create epic with --labels flag to set
    categorical and list properties. '
  inputs:
    args:
    - cupboard create --type epic --title "Storage layer" --labels "code,infra" --json
  expected:
    exit_code: 0
    stdout_structure: '{"type": "epic", "title": "Storage layer", "labels": ["code",
      "infra"]}'
- name: Get benchmark with 10 crumbs
  description: 'Measure Table.Get latency with 10 seeded crumbs. Benchmark uses random
    ID selection to measure average lookup time. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsGet10 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsGet10
- name: Get benchmark with 100 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsGet100 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsGet100
- name: Get benchmark with 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsGet1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsGet1000
- name: Get benchmark with 10000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsGet10000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsGet10000
- name: Set create benchmark with 10 existing crumbs
  description: 'Measure Table.Set latency for creating new crumbs (empty ID triggers
    UUID v7 generation). Includes JSONL sync cost per prd002-sqlite-backend R5.3. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsSetCreate10 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsSetCreate10
- name: Set create benchmark with 1000 existing crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsSetCreate1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsSetCreate1000
- name: Set update benchmark with 10 crumbs
  description: 'Measure Table.Set latency for updating existing crumbs. Includes JSONL
    sync cost per prd002-sqlite-backend R5.3. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsSetUpdate10 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsSetUpdate10
- name: Set update benchmark with 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsSetUpdate1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsSetUpdate1000
- name: Delete benchmark with 10 crumbs
  description: 'Measure Table.Delete latency including cascade deletion of property
    values, metadata, and links per prd003-crumbs-interface R8.3. Each iteration creates
    then deletes a crumb. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsDelete10 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsDelete10
- name: Delete benchmark with 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsDelete1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsDelete1000
- name: Fetch all benchmark with 100 crumbs
  description: 'Measure Table.Fetch latency with empty filter (returns all crumbs).
    Exercises full table scan with entity hydration. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchAll100 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchAll100
- name: Fetch all benchmark with 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchAll1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchAll1000
- name: Fetch with state filter benchmark 100 crumbs
  description: 'Measure Table.Fetch with state filter. Exercises idx_crumbs_state
    index per prd002-sqlite-backend R3.3. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchState100 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchState100
- name: Fetch with state filter benchmark 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchState1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchState1000
- name: Fetch with properties filter benchmark 100 crumbs
  description: 'Measure Table.Fetch with crumbs that have properties set. Exercises
    crumb_properties table hydration. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchProperties100 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchProperties100
- name: Fetch with properties filter benchmark 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchProperties1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchProperties1000
- name: Fetch with limit simulation benchmark
  description: 'Measure Table.Fetch from 1000 crumbs simulating limit behavior. Fetches
    all then takes first 10 to establish baseline for future limit filter support. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbsFetchLimit100 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbsFetchLimit100
- name: SetProperty benchmark with 10 crumbs
  description: 'Measure Crumb.SetProperty + Table.Set latency. Includes Get, SetProperty,
    and Set to persist with JSONL write for crumb_properties. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbSetProperty10 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbSetProperty10
- name: SetProperty benchmark with 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbSetProperty1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbSetProperty1000
- name: GetProperty benchmark with 10 crumbs
  description: 'Measure Crumb.GetProperty latency. This is a read-only operation on
    the in-memory Properties map. Benchmarks in-memory crumb objects without database
    access. '
  inputs:
    args:
    - go test -bench=BenchmarkCrumbGetProperty10 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbGetProperty10
- name: GetProperty benchmark with 1000 crumbs
  inputs:
    args:
    - go test -bench=BenchmarkCrumbGetProperty1000 -benchmem ./tests/integration/...
  expected:
    exit_code: 0
    stdout: BenchmarkCrumbGetProperty1000
- name: Initialize cupboard
  inputs:
    args:
    - cupboard init
  expected:
    exit_code: 0
    stdout: output message
- name: Create task with required fields
  inputs:
    args:
    - cupboard set crumbs "" '{"Name":"Implement feature","State":"draft"}'
  expected:
    exit_code: 0
    stdout: CrumbID
- name: Create task with JSON output
  inputs:
    args:
    - cupboard set crumbs "" '{"Name":"Write tests","State":"draft"}'
  expected:
    exit_code: 0
    stdout_structure: '{"Name": "Write tests", "State": "draft"}'
- name: Create epic with labels
  inputs:
    args:
    - cupboard set crumbs "" '{"Name":"Storage layer","State":"draft"}'
  expected:
    exit_code: 0
    stdout: CrumbID
- name: Create task with parent
  description: 'Create a parent crumb first, then create a child crumb. Parent-child
    relationships use the links table, not inline JSON fields. '
  inputs:
    args:
    - cupboard set crumbs "" '{"Name":"Child task","State":"draft"}'
  expected:
    exit_code: 0
    stdout: CrumbID
- name: Create without name succeeds
  description: 'Current CLI does not enforce required Name field. Set without Name
    succeeds but creates a crumb with empty Name. '
  inputs:
    args:
    - cupboard set crumbs "" '{"State":"draft"}'
  expected:
    exit_code: 0
- name: Create without state defaults
  inputs:
    args:
    - cupboard set crumbs "" '{"Name":"No state provided"}'
  expected:
    exit_code: 0
- name: List returns all crumbs as JSON
  inputs:
    args:
    - cupboard list crumbs
  expected:
    exit_code: 0
    stdout_structure: '{"length": 2}'
- name: List empty cupboard returns empty array
  inputs:
    args:
    - cupboard list crumbs
  expected:
    exit_code: 0
    stdout_structure: '{"length": 0}'
- name: Show displays crumb details
  inputs:
    args:
    - cupboard get crumbs ${crumb_id}
  expected:
    exit_code: 0
    stdout: Visible task
- name: Show nonexistent ID fails
  inputs:
    args:
    - cupboard get crumbs nonexistent-id
  expected:
    exit_code: 1
- name: Update status to taken (in_progress)
  inputs:
    args:
    - cupboard set crumbs ${crumb_id} '{"CrumbID":"${crumb_id}","Name":"Updated","State":"taken"}'
  expected:
    exit_code: 0
- name: Update status to pebble (closed)
  inputs:
    args:
    - cupboard set crumbs ${crumb_id} '{"CrumbID":"${crumb_id}","Name":"Updated","State":"pebble"}'
  expected:
    exit_code: 0
- name: Close sets state to pebble
  inputs:
    args:
    - cupboard set crumbs ${crumb_id} '{"CrumbID":"${crumb_id}","Name":"Closed","State":"pebble"}'
  expected:
    exit_code: 0
- name: Close already-closed crumb succeeds
  inputs:
    args:
    - cupboard set crumbs ${crumb_id} '{"CrumbID":"${crumb_id}","Name":"Closed","State":"pebble"}'
  expected:
    exit_code: 0
- name: Ready returns draft crumbs (open tasks)
  inputs:
    args:
    - cupboard list crumbs State=draft
  expected:
    exit_code: 0
    stdout_structure: '{"length": 1}'
- name: Ready with no open tasks returns empty
  inputs:
    args:
    - cupboard list crumbs State=draft
  expected:
    exit_code: 0
    stdout_structure: '{"length": 0}'
- name: Do-work cycle
  description: 'Simulates the do-work workflow: create task, list ready tasks (draft),
    claim task (set state to taken), close task (set state to pebble). Comments are
    not yet implemented; token tracking step is skipped. '
  inputs: {}
  expected:
    exit_code: 0
- name: Make-work cycle
  description: 'Simulates the make-work workflow: list existing issues, create an
    epic, create child tasks. Parent links use the links table (not tested here). '
  inputs: {}
  expected:
    exit_code: 0
- name: JSONL persistence
  description: 'Validates that crumb data is persisted to crumbs.jsonl file. '
  inputs: {}
  expected:
    exit_code: 0
- name: Create comment with empty ID generates UUID v7
  description: Calling Table.Set on metadata table with empty ID and comments schema
    generates a UUID v7 identifier.
  inputs: {}
  expected: {}
- name: Create attachment with empty ID generates UUID v7
  description: Calling Table.Set on metadata table with empty ID and attachments schema
    generates a UUID v7 identifier.
  inputs: {}
  expected: {}
- name: Multiple comments accumulate on same crumb
  description: Adding multiple comment metadata entries does not replace previous
    entries.
  inputs: {}
  expected: {}
- name: Comments and attachments coexist on same crumb
  description: A crumb can have both comment and attachment metadata entries.
  inputs: {}
  expected: {}
- name: Comment stores plain text content
  description: Metadata with comments schema stores Content as plain text including
    special characters.
  inputs: {}
  expected: {}
- name: Attachment stores JSON content
  description: Metadata with attachments schema stores Content as JSON string that
    can be parsed.
  inputs: {}
  expected: {}
- name: Get retrieves metadata with matching fields
  description: Table.Get returns metadata with all fields matching what was created.
  inputs: {}
  expected: {}
- name: Fetch with schema filter returns comments only
  description: Table.Fetch with TableName=comments filter returns only comment entries.
  inputs: {}
  expected: {}
- name: Fetch with schema filter returns attachments only
  description: Table.Fetch with TableName=attachments filter returns only attachment
    entries.
  inputs: {}
  expected: {}
- name: Fetch with crumb_id filter returns entries for specific crumb
  description: Table.Fetch with CrumbID filter returns only metadata for that crumb.
  inputs: {}
  expected: {}
- name: Fetch with crumb_id for crumb with no metadata returns empty
  description: Table.Fetch with CrumbID filter for crumb without metadata returns
    empty slice.
  inputs: {}
  expected: {}
- name: Fetch with schema and crumb_id filters returns intersection
  description: Table.Fetch with both TableName and CrumbID filters returns entries
    matching both.
  inputs: {}
  expected: {}
- name: Get nonexistent metadata returns ErrNotFound
  description: Table.Get with a nonexistent metadata ID returns ErrNotFound.
  inputs: {}
  expected: {}
- name: Get with empty ID returns ErrInvalidID
  description: Table.Get with an empty ID returns ErrInvalidID.
  inputs: {}
  expected: {}
- name: Delete crumb cascades to metadata
  description: When a crumb is deleted, all its metadata entries are also deleted.
  inputs: {}
  expected: {}
- name: Cascade delete only affects target crumb metadata
  description: Deleting one crumb does not affect metadata on other crumbs.
  inputs: {}
  expected: {}
- name: Fetch from empty table returns empty result
  description: Table.Fetch with nil filter on empty metadata table returns empty slice
    without error.
  inputs: {}
  expected: {}
- name: Delete nonexistent metadata returns ErrNotFound
  description: Table.Delete with a nonexistent metadata ID returns ErrNotFound.
  inputs: {}
  expected: {}
- name: Delete metadata with empty ID returns ErrInvalidID
  description: Table.Delete with an empty ID returns ErrInvalidID.
  inputs: {}
  expected: {}
